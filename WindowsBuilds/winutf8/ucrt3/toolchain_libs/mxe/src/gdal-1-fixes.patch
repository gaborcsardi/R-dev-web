This file is part of MXE. See LICENSE.md for licensing information.

Contains ad hoc patches for cross building.

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Luke Potgieter <fried.roadkill+ght@gmail.com>
Date: Tue, 29 Aug 2017 16:31:09 +0200
Subject: [PATCH 1/3] Detect spatialite more effectively than just checking for
 headers in the system paths. PostgreSQL detection requires -lpthread when
 building statically.


diff --git a/configure.ac b/configure.ac
index 1111111..2222222 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1124,7 +1124,7 @@ else
 
   AC_MSG_RESULT([yes])
 
-  AC_CHECK_LIB(pq,PQconnectdb,HAVE_PG=yes,HAVE_PG=no,-L`$PG_CONFIG --libdir`)
+  AC_CHECK_LIB(pq,PQconnectdb,HAVE_PG=yes,HAVE_PG=no,-L`$PG_CONFIG --libdir` -lpthread)
 
   if test "${HAVE_PG}" = "yes" ; then
     LIBS=-L`$PG_CONFIG --libdir`" -lpq $LIBS"
@@ -3598,16 +3598,21 @@ AC_ARG_WITH(spatialite-soname,
 
 HAVE_SPATIALITE=no
 SPATIALITE_AMALGAMATION=no
+HAVE_SPAT_PKG=no
 
 if test -z "$with_spatialite" -o "$with_spatialite" = "no"; then
     AC_MSG_RESULT(disabled)
 elif test "$with_spatialite" = "yes"; then
     AC_CHECK_HEADERS(sqlite3.h)
     if test "$ac_cv_header_sqlite3_h" = "yes"; then
-        AC_MSG_CHECKING([for spatialite.h in /usr/include or /usr/local/include])
-        if test -f "/usr/include/spatialite.h" -o -f "/usr/local/include/spatialite.h"; then
-            AC_MSG_RESULT(found)
+        #AC_MSG_CHECKING([for spatialite.h in /usr/include or /usr/local/include])
+        #if test -f "/usr/include/spatialite.h" -o -f "/usr/local/include/spatialite.h"; then
+        PKG_CHECK_MODULES(SPATIALITE, spatialite, [HAVE_SPAT_PKG=yes], [HAVE_SPAT_PKG=no])
+        if test "$HAVE_SPAT_PKG" = "yes"; then
+            OLD_LIBS="$LIBS"
+            LIBS="$LIBS -lsqlite3 -lspatialite -lgeos_c -lgeos -lxml2 -liconv -llzma -lproj -lstdc++ -lws2_32 -lm -lz"
             AC_CHECK_LIB(spatialite,spatialite_init,SPATIALITE_INIT_FOUND=yes,SPATIALITE_INIT_FOUND=no,)
+            LIBS="$OLD_LIBS"
             if test "$SPATIALITE_INIT_FOUND" = "yes"; then
                 HAVE_SPATIALITE=yes
                 SPATIALITE_LIBS="-lspatialite -lsqlite3"
diff --git a/m4/geos.m4 b/m4/geos.m4
index 1111111..2222222 100644
--- a/m4/geos.m4
+++ b/m4/geos.m4
@@ -121,14 +121,14 @@ AC_DEFUN([GEOS_INIT],[
 
       HAVE_GEOS="no"
 
-      GEOS_LIBS="`${GEOS_CONFIG} --ldflags` -lgeos_c"
+      GEOS_LIBS="`${GEOS_CONFIG} --clibs`"
       GEOS_CFLAGS="`${GEOS_CONFIG} --cflags`"
       GEOS_VERSION="`${GEOS_CONFIG} --version`"
 
       ax_save_LIBS="${LIBS}"
-      LIBS=${GEOS_LIBS}
+      LIBS="${LIBS} ${GEOS_LIBS}"
       ax_save_CFLAGS="${CFLAGS}"
-      CFLAGS="${GEOS_CFLAGS}"
+      CFLAGS="${CFLAGS} ${GEOS_CFLAGS}"
 
       AC_CHECK_LIB([geos_c],
         [GEOSversion],

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Luke Potgieter <fried.roadkill+ght@gmail.com>
Date: Tue, 26 Sep 2017 14:56:19 +0200
Subject: [PATCH 2/3] Use the new proj dll version number for the latest proj.


diff --git a/ogr/ogrct.cpp b/ogr/ogrct.cpp
index 1111111..2222222 100644
--- a/ogr/ogrct.cpp
+++ b/ogr/ogrct.cpp
@@ -96,9 +96,9 @@ static bool      bProjLocaleSafe = false;
 // build) it can be named either way, so use PROJSO environment variable to
 // specify the right library name. By default assume that in Cygwin/MinGW all
 // components were built in the same way.
-#  define LIBNAME "libproj-9.dll"
+#  define LIBNAME "libproj-12.dll"
 #elif defined(__CYGWIN__)
-#  define LIBNAME "cygproj-9.dll"
+#  define LIBNAME "cygproj-12.dll"
 #elif defined(__APPLE__)
 #  define LIBNAME "libproj.dylib"
 #else

From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Mark Brand <mabrand@mabrand.nl>
Date: Sun, 3 Apr 2022 22:52:30 +0200
Subject: [PATCH 3/3] detect openjpeg-2.4 in MXE


diff --git a/configure.ac b/configure.ac
index 1111111..2222222 100644
--- a/configure.ac
+++ b/configure.ac
@@ -2540,11 +2540,11 @@ if test "$with_openjpeg" = "no" ; then
 elif test "$with_openjpeg" = "yes" -o "$with_openjpeg" = "" ; then
 
 
-  AC_CHECK_HEADERS([openjpeg-2.3/openjpeg.h])
-  if test "$ac_cv_header_openjpeg_2_3_openjpeg_h" = "yes"; then
+  AC_CHECK_HEADERS([openjpeg-2.4/openjpeg.h])
+  if test "$ac_cv_header_openjpeg_2_4_openjpeg_h" = "yes"; then
     AC_CHECK_LIB(openjp2,opj_stream_set_user_data_length,HAVE_OPENJPEG=yes,HAVE_OPENJPEG=no,)
     if test "$HAVE_OPENJPEG" = "yes"; then
-        OPENJPEG_VERSION=20300
+        OPENJPEG_VERSION=20400
         LIBS="-lopenjp2 $LIBS"
     fi
   else
@@ -2585,11 +2585,11 @@ else
   elif test -r $with_openjpeg/include/openjpeg-2.2/openjpeg.h ; then
     OPENJPEG_VERSION=20200
     EXTRA_INCLUDES="-I$with_openjpeg/include $EXTRA_INCLUDES"
-  elif test -r $with_openjpeg/include/openjpeg-2.3/openjpeg.h ; then
-    OPENJPEG_VERSION=20300
+  elif test -r $with_openjpeg/include/openjpeg-2.4/openjpeg.h ; then
+    OPENJPEG_VERSION=20400
     EXTRA_INCLUDES="-I$with_openjpeg/include $EXTRA_INCLUDES"
   else
-    AC_MSG_ERROR([openjpeg.h not found in $with_openjpeg/include/openjpeg-2.0 or $with_openjpeg/include/openjpeg-2.1 or $with_openjpeg/include/openjpeg-2.2 or $with_openjpeg/include/openjpeg-2.3])
+    AC_MSG_ERROR([openjpeg.h not found in $with_openjpeg/include/openjpeg-2.0 or $with_openjpeg/include/openjpeg-2.1 or $with_openjpeg/include/openjpeg-2.2 or $with_openjpeg/include/openjpeg-2.4])
   fi
 
   AC_CHECK_LIB(openjp2,opj_stream_set_user_data_length,HAVE_OPENJPEG=yes,HAVE_OPENJPEG=no,-L$with_openjpeg/lib)
diff --git a/frmts/openjpeg/openjpegdataset.cpp b/frmts/openjpeg/openjpegdataset.cpp
index 1111111..2222222 100644
--- a/frmts/openjpeg/openjpegdataset.cpp
+++ b/frmts/openjpeg/openjpegdataset.cpp
@@ -34,8 +34,8 @@
 #pragma clang diagnostic ignored "-Wdocumentation"
 #endif
 
-#if defined(OPENJPEG_VERSION) && OPENJPEG_VERSION >= 20300
-#include <openjpeg-2.3/openjpeg.h>
+#if defined(OPENJPEG_VERSION) && OPENJPEG_VERSION >= 20400
+#include <openjpeg-2.4/openjpeg.h>
 #elif defined(OPENJPEG_VERSION) && OPENJPEG_VERSION >= 20200
 #include <openjpeg-2.2/openjpeg.h>
 #elif defined(OPENJPEG_VERSION) && OPENJPEG_VERSION >= 20100
diff -ru gdal-3.3.2-orig/apps/commonutils.h gdal-3.3.2-new/apps/commonutils.h
--- gdal-3.3.2-orig/apps/commonutils.h	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/commonutils.h	2021-09-24 20:35:39.599706347 +0000
@@ -75,7 +75,44 @@
 #define MAIN_END
 
 #endif // defined(WIN32)
-#endif // defined(__cplusplus)
+#else // defined(__cplusplus) ----------------------------------
+
+#if defined(WIN32) && (defined(_MSC_VER) || defined(SUPPORTS_WMAIN))
+
+#include <wchar.h>
+#include <stdlib.h>
+#include "cpl_conv.h"
+#include "cpl_string.h"
+
+int wmain( int argc, wchar_t ** argv_w, wchar_t ** envp );
+
+#define MAIN_START(argc, argv) \
+  int wmain( int argc, wchar_t ** argv_w, wchar_t **envp ) \
+  { \
+    char **argv = (char**)(CPLCalloc(argc + 1, sizeof(char*))); \
+    { \
+      int i; \
+      for( i = 0; i < argc; i++ ) \
+      { \
+        argv[i] = CPLRecodeFromWChar( argv_w[i], CPL_ENC_UCS2, CPL_ENC_UTF8 ); \
+      } \
+    }
+
+// NOTE: memory will not be explicitly freed on exit/return from wmain()
+
+#define MAIN_END CSLDestroy(argv); \
+    return 0; \
+  }
+
+#else // defined(WIN32)
+
+#define MAIN_START(argc, argv) \
+    int main( int argc, char ** argv )
+
+#define MAIN_END
+
+#endif // defined(WIN32)
+#endif // (!__cplusplus__)
 
 
 CPL_C_START
diff -ru gdal-3.3.2-orig/apps/dumpoverviews.cpp gdal-3.3.2-new/apps/dumpoverviews.cpp
--- gdal-3.3.2-orig/apps/dumpoverviews.cpp	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/dumpoverviews.cpp	2021-09-24 11:24:29.197007787 +0000
@@ -31,6 +31,7 @@
 #include "cpl_string.h"
 #include "gdal_priv.h"
 #include "ogr_spatialref.h"
+#include "commonutils.h"
 
 CPL_CVSID("$Id: dumpoverviews.cpp 355b41831cd2685c85d1aabe5b95665a2c6e99b7 2019-06-19 17:07:04 +0200 Even Rouault $")
 
@@ -51,7 +52,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main( int argc, char ** argv )
+MAIN_START(argc, argv)
 
 {
     GDALAllRegister();
@@ -180,6 +181,7 @@
 
     return 0;
 }
+MAIN_END
 
 /************************************************************************/
 /*                              DumpBand()                              */
diff -ru gdal-3.3.2-orig/apps/gdal2ogr.c gdal-3.3.2-new/apps/gdal2ogr.c
--- gdal-3.3.2-orig/apps/gdal2ogr.c	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/gdal2ogr.c	2021-09-24 11:24:29.197007787 +0000
@@ -31,6 +31,7 @@
 #include "ogr_api.h"
 #include "ogr_srs_api.h"
 #include "cpl_string.h"
+#include "commonutils.h"
 
 CPL_CVSID("$Id: gdal2ogr.c 355b41831cd2685c85d1aabe5b95665a2c6e99b7 2019-06-19 17:07:04 +0200 Even Rouault $")
 
@@ -73,7 +74,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main(int argc, char* argv[])
+MAIN_START(argc, argv)
 {
     const char     *pszFormat = "ESRI Shapefile";
     char           *pszLayerName = NULL;
@@ -337,3 +338,4 @@
 
     return 0;
 }
+MAIN_END
\ No newline at end of file
diff -ru gdal-3.3.2-orig/apps/gdalasyncread.cpp gdal-3.3.2-new/apps/gdalasyncread.cpp
--- gdal-3.3.2-orig/apps/gdalasyncread.cpp	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/gdalasyncread.cpp	2021-09-24 20:35:43.335706362 +0000
@@ -32,6 +32,7 @@
 #include "gdal_version.h"
 #include "gdal_priv.h"
 #include "ogr_spatialref.h"
+#include "commonutils.h"
 
 CPL_CVSID("$Id: gdalasyncread.cpp 3933b3a21990c6b7072b1a4e50e8520c7bfaf1f8 2021-06-09 17:21:21 +0800 C41eb $")
 
@@ -73,7 +74,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main( int argc, char ** argv )
+MAIN_START(argc, argv)
 
 {
     GDALDatasetH        hSrcDS, hDstDS;
@@ -558,3 +559,4 @@
     GDALDumpOpenDatasets( stderr );
     GDALDestroyDriverManager();
 }
+MAIN_END
diff -ru gdal-3.3.2-orig/apps/gdalflattenmask.c gdal-3.3.2-new/apps/gdalflattenmask.c
--- gdal-3.3.2-orig/apps/gdalflattenmask.c	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/gdalflattenmask.c	2021-09-24 11:24:29.201007787 +0000
@@ -29,6 +29,7 @@
 #include "gdal.h"
 #include "cpl_conv.h"
 #include "cpl_string.h"
+#include "commonutils.h"
 
 CPL_CVSID("$Id: gdalflattenmask.c 355b41831cd2685c85d1aabe5b95665a2c6e99b7 2019-06-19 17:07:04 +0200 Even Rouault $")
 
@@ -55,7 +56,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main(int argc, char* argv[])
+MAIN_START(argc, argv)
 {
     const char* pszFormat = "GTiff";
     const char* pszSrcFilename = NULL;
@@ -338,3 +339,4 @@
 
     return 0;
 }
+MAIN_END
diff -ru gdal-3.3.2-orig/apps/gdaltorture.cpp gdal-3.3.2-new/apps/gdaltorture.cpp
--- gdal-3.3.2-orig/apps/gdaltorture.cpp	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/gdaltorture.cpp	2021-09-24 11:24:29.201007787 +0000
@@ -29,6 +29,7 @@
 #include "gdal.h"
 #include "cpl_string.h"
 #include "cpl_conv.h"
+#include "commonutils.h"
 
 #include <cassert>
 
@@ -237,7 +238,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main( int argc, char **argv )
+MAIN_START(argc, argv)
 {
     GDALAllRegister();
 
@@ -292,3 +293,4 @@
 
     return 0;
 }
+MAIN_END
\ No newline at end of file
diff -ru gdal-3.3.2-orig/apps/gdalwarpsimple.c gdal-3.3.2-new/apps/gdalwarpsimple.c
--- gdal-3.3.2-orig/apps/gdalwarpsimple.c	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/gdalwarpsimple.c	2021-09-24 11:24:29.201007787 +0000
@@ -31,6 +31,7 @@
 #include "gdal_alg.h"
 #include "cpl_string.h"
 #include "ogr_srs_api.h"
+#include "commonutils.h"
 
 CPL_CVSID("$Id: gdalwarpsimple.c ff8146d84de7cba8e09d212d5481ea7d2ede3e98 2017-06-27 20:47:31Z Even Rouault $")
 
@@ -91,7 +92,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main( int argc, char ** argv )
+MAIN_START(argc, argv)
 
 {
     GDALDatasetH        hSrcDS, hDstDS;
@@ -313,6 +314,7 @@
 
     exit( 0 );
 }
+MAIN_END
 
 /************************************************************************/
 /*                        GDALWarpCreateOutput()                        */
diff -ru gdal-3.3.2-orig/apps/multireadtest.cpp gdal-3.3.2-new/apps/multireadtest.cpp
--- gdal-3.3.2-orig/apps/multireadtest.cpp	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/multireadtest.cpp	2021-09-24 11:24:29.205007787 +0000
@@ -30,6 +30,7 @@
 #include "gdal_alg.h"
 #include "cpl_multiproc.h"
 #include "cpl_string.h"
+#include "commonutils.h"
 #include <vector>
 
 CPL_CVSID("$Id: multireadtest.cpp cf1507fcfdb6ef16ec9afab68cc0d7d969c7bcbd 2020-02-27 21:22:11 +0100 Even Rouault $")
@@ -121,8 +122,7 @@
 /*                                main()                                */
 /************************************************************************/
 
-int main( int argc, char ** argv )
-
+MAIN_START(argc, argv)
 {
 /* -------------------------------------------------------------------- */
 /*      Process arguments.                                              */
@@ -254,3 +254,4 @@
 
     return 0;
 }
+MAIN_END
diff -ru gdal-3.3.2-orig/apps/testreprojmulti.cpp gdal-3.3.2-new/apps/testreprojmulti.cpp
--- gdal-3.3.2-orig/apps/testreprojmulti.cpp	2021-09-24 11:23:42.669007602 +0000
+++ gdal-3.3.2-new/apps/testreprojmulti.cpp	2021-09-24 11:24:29.205007787 +0000
@@ -32,6 +32,7 @@
 #include "cpl_atomic_ops.h"
 #include "cpl_multiproc.h"
 #include "ogr_spatialref.h"
+#include "commonutils.h"
 
 CPL_CVSID("$Id: testreprojmulti.cpp 355b41831cd2685c85d1aabe5b95665a2c6e99b7 2019-06-19 17:07:04 +0200 Even Rouault $")
 
@@ -63,7 +64,7 @@
         CPLAtomicInc(&nIter);
         memcpy(padfResultX, padfRefX, 1024 * sizeof(double));
         memcpy(padfResultY, padfRefY, 1024 * sizeof(double));
-        poCT->TransformEx( 1024, padfResultX, padfResultY, nullptr, nullptr );
+        poCT->Transform( 1024, padfResultX, padfResultY, nullptr);
 
         /* Check that the results are consistent with the reference results */
         assert(memcmp(padfResultX, padfRefResultX, 1024 * sizeof(double)) == 0);
@@ -74,7 +75,7 @@
     }
 }
 
-int main(int argc, char* argv[])
+MAIN_START(argc, argv)
 {
     int nThreads = 2;
 
@@ -109,7 +110,7 @@
     memcpy(padfRefResultX, padfRefX, 1024 * sizeof(double));
     memcpy(padfRefResultY, padfRefY, 1024 * sizeof(double));
 
-    poCT->TransformEx( 1024, padfRefResultX, padfRefResultY, nullptr, nullptr );
+    poCT->Transform( 1024, padfRefResultX, padfRefResultY, nullptr);
 
     for(int i=0;i<nThreads;i++)
         CPLCreateThread(ReprojFunc, nullptr);
@@ -119,3 +120,4 @@
 
     return 0;
 }
+MAIN_END
diff -ru gdal-3.3.2-orig/configure gdal-3.3.2-new/configure
--- gdal-3.3.2-orig/configure	2021-09-24 11:23:42.661007602 +0000
+++ gdal-3.3.2-new/configure	2021-09-24 11:34:26.061010161 +0000
@@ -33461,7 +33461,7 @@
     NETCDF_VERSION=`$NETCDF_NCCONFIG --version`
     NETCDF_PREFIX=`$NETCDF_NCCONFIG --prefix`
     NETCDF_INCLUDEDIR=`$NETCDF_NCCONFIG --includedir`
-    NETCDF_LIBS=`$NETCDF_NCCONFIG --libs`
+    NETCDF_LIBS=`$NETCDF_NCCONFIG --static --libs`
 
     if echo "x" | sed -E "s/x/y/" >/dev/null 2>/dev/null; then
         STRIPPED_LIBRARY_NAME="$(echo "${NETCDF_LIBS}" | sed -E 's:-L/(usr/)?(lib(64)?|lib/x86_64-linux-gnu)/*[[:space:]]+::')"
@@ -33525,6 +33525,8 @@
       EXTRA_INCLUDES="-I$NETCDF_INCLUDEDIR $EXTRA_INCLUDES"
       NETCDF_ROOT=$NETCDF_PREFIX
       LIBS="$NETCDF_LIBS $LIBS"
+    else
+      as_fn_error $? "\"Netcdf via nc-config not working\"" "$LINENO" 5
     fi
 
 
@@ -38506,7 +38508,7 @@
 
       HAVE_GEOS="no"
 
-      GEOS_LIBS="`${GEOS_CONFIG} --ldflags` -lgeos_c"
+      GEOS_LIBS="`${GEOS_CONFIG} --static-clibs`"
       GEOS_CFLAGS="`${GEOS_CONFIG} --cflags`"
       GEOS_VERSION="`${GEOS_CONFIG} --version`"
 
@@ -42601,7 +42603,7 @@
         if test $RETVAL -eq 0; then
             { $as_echo "$as_me:${as_lineno-$LINENO}: result: yes" >&5
 $as_echo "yes" >&6; }
-            CXXFLAGS="$CXXFLAGS -DSUPPORTS_WMAIN"
+            CPPFLAGS="$CPPFLAGS -DSUPPORTS_WMAIN"
             LDFLAGS="$LDFLAGS -municode"
         else
             { $as_echo "$as_me:${as_lineno-$LINENO}: result: no" >&5
diff -ru gdal-3.3.2-orig/configure.ac gdal-3.3.2-new/configure.ac
--- gdal-3.3.2-orig/configure.ac	2021-09-24 11:23:42.517007601 +0000
+++ gdal-3.3.2-new/configure.ac	2021-09-24 11:31:51.581009547 +0000
@@ -3163,7 +3163,7 @@
     NETCDF_VERSION=`$NETCDF_NCCONFIG --version`
     NETCDF_PREFIX=`$NETCDF_NCCONFIG --prefix`
     NETCDF_INCLUDEDIR=`$NETCDF_NCCONFIG --includedir`
-    NETCDF_LIBS=`$NETCDF_NCCONFIG --libs`
+    NETCDF_LIBS=`$NETCDF_NCCONFIG --static --libs`
     STRIP_SYSTEM_LIBRARY_PATHS("${NETCDF_LIBS}")
     NETCDF_LIBS="$STRIPPED_LIBRARY_NAME"
     echo ""
@@ -3176,6 +3176,8 @@
       EXTRA_INCLUDES="-I$NETCDF_INCLUDEDIR $EXTRA_INCLUDES"
       NETCDF_ROOT=$NETCDF_PREFIX
       LIBS="$NETCDF_LIBS $LIBS"
+    else
+      AC_MSG_ERROR("Netcdf via nc-config not working")
     fi
 
 dnl previous behavior without nc-config
@@ -6032,7 +6034,7 @@
         rm -f testwmain*
         if test $RETVAL -eq 0; then
             AC_MSG_RESULT([yes])
-            CXXFLAGS="$CXXFLAGS -DSUPPORTS_WMAIN"
+            CPPFLAGS="$CPPFLAGS -DSUPPORTS_WMAIN"
             LDFLAGS="$LDFLAGS -municode"
         else
             AC_MSG_RESULT([no])
diff -ru gdal-3.3.2-orig/m4/geos.m4 gdal-3.3.2-new/m4/geos.m4
--- gdal-3.3.2-orig/m4/geos.m4	2021-09-24 11:23:42.605007601 +0000
+++ gdal-3.3.2-new/m4/geos.m4	2021-09-24 11:24:29.225007787 +0000
@@ -124,7 +124,7 @@
 
       HAVE_GEOS="no"
 
-      GEOS_LIBS="`${GEOS_CONFIG} --ldflags` -lgeos_c"
+      GEOS_LIBS="`${GEOS_CONFIG} --static-clibs`"
       GEOS_CFLAGS="`${GEOS_CONFIG} --cflags`"
       GEOS_VERSION="`${GEOS_CONFIG} --version`"
 
diff -ru gdal-3.3.2-orig/port/cpl_port.h gdal-3.3.2-new/port/cpl_port.h
--- gdal-3.3.2-orig/port/cpl_port.h	2021-09-24 11:23:42.661007602 +0000
+++ gdal-3.3.2-new/port/cpl_port.h	2021-09-24 11:24:29.225007787 +0000
@@ -113,15 +113,6 @@
 /*      MinGW stuff                                                     */
 /* ==================================================================== */
 
-/* We need __MSVCRT_VERSION__ >= 0x0700 to have "_aligned_malloc" */
-/* Latest versions of mingw32 define it, but with older ones, */
-/* we need to define it manually */
-#if defined(__MINGW32__)
-#ifndef __MSVCRT_VERSION__
-#define __MSVCRT_VERSION__ 0x0700
-#endif
-#endif
-
 /* Needed for std=c11 on Solaris to have strcasecmp() */
 #if defined(GDAL_COMPILATION) && defined(__sun__) && (__STDC_VERSION__ + 0) >= 201112L && (_XOPEN_SOURCE + 0) < 600
 #ifdef _XOPEN_SOURCE
