<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Emacs Tags for R</title>

<style type="text/css">

body
{
  font-family: Georgia, serif;
  width: 60%;
  padding-left: 20%;
}

a
{
  /* color: rgb(55,55,0); */
  color: rgb(55,55,150);
  font-weight: bold;
  text-decoration: none;
}
a:hover
{
  color: #cc2211;
}

h1
{
  font-size: 125%;
  text-align: center;
  color: #cc2211;
}

h2
{
  font-size: 120%;
  border-bottom: medium solid #cc2211;
  background: #eeeeee;
}

li
{
  padding: 0.6em;
  text-decoration: none;
}

pre
{
  background: #eeeeee;
  padding: 0.5em;
  border: thin solid #cc2211;
}

</style>

</head>

<body>

<h1>Emacs Tags for R</h1>

<h2>Background</h2>

<p>Many text editors allow definitions of functions and other language
objects to be quickly and easily located in source files through a
tagging utility.  This functionality requires the relevant source
files to be preprocessed, producing an index (or tag) file containing
the names and their corresponding locations.  There are multiple tag
file formats, the most popular being the vi-style ctags format and the
and emacs-style etags format.  Tag files in these formats are usually
generated by the <code>ctags</code> and <code>etags</code> utilities
respectively. Unfortunately, these programs do not recognize R code
syntax.  They do allow tagging of arbitrary language files through
regular expressions, but this is not sufficient for R.</p>

<p>R 2.9.0 onwards provides the <code>rtags</code> function as a
tagging utility for R code.  It parses R code files (using R's parser)
and produces tags in Emacs' <code>etags</code> format.</p>

<h2>Using rtags</h2>

<p> The API provided by <code>rtags()</code> is described in the
online documentation.  In practice, one would typically want to tag
not only R files, but also C/C++ files in a package (or the R
sources), and possibly the documentation files as well.  C files can
be tagged by <code>etags</code>, as can R documentation files using
its regular expression feature; e.g.,

<pre>$ etags -l none --regex='/\\alias[{]\([^{}]*\)[}]/\1/' foo.Rd</pre>

R provides a front-end script <code>R CMD rtags</code> to make this
typical use-case easier.  The usage is given by

<pre>$ R CMD rtags --help
Usage: R CMD rtags [options] [path]

Tag C, R, and Rd files under the directory 'path' (pwd by default).

Options:
  -h, --help            print short help message and exit
  -v, --version         print version info and exit
  -o, --output=FILE     write output to FILE (default TAGS)
      --no-c            do not tag C (.c, .h) files
      --no-R            do not tag R (.R, .r, .S, .s) files
      --no-Rd           do not tag Rd (.Rd) files
  -a  --append          append to output file (overwrites by default) 
  -V, --verbose         echo the name of files processed

Report bugs to &lt;deepayan.sarkar@r-project.org&gt;.
</pre>
A typical sequence of calls to generate a TAGS file might be
<pre>$ R CMD rtags -o TAGS /path/to/Rpacks
$ R CMD rtags.sh -o TAGS --append /path/to/R/trunk/src</pre>
where <code>/path/to/Rpacks</code> contains multiple R packages, and
<code>/path/to/R/trunk</code> contains a checkout of the trunk of the
R svn tree.  </p>


<p>Once the TAGS file is created, it can be loaded inside an Emacs
session using <code>M-x visit-tags-table RET TAGS</code>.  The
definition of a symbol can now be located using the <code>M-.</code>
keyboard shortcut (see the <a
href="http://www.gnu.org/software/emacs/emacs-lisp-intro/html_node/emacs.html#Tags"
>Emacs manual</a> for more details)</p>

<h2>Features</h2>

<code>rtags</code> can successfully tag normal R function declarations
of the form <code>foo &lt;- function(...)</code>.  It also knows about
<code>S4</code> constructs such as <code>setClass</code> and
<code>setMethod</code>.  A special markup is used for <code>S4</code>
method definitions: for example, in the <code>Matrix</code> package,
the <code>solve</code> method with <code>signature("CHMfactor",
"matrix")</code> will be tagged with the token
<code>solve,CHMfactor,matrix</code>.  This is useful because in
conjuntion with Emacs' tag completion feature, it can make locating
the method of interest much easier.  For example,

<pre>M-. solve TAB TAB</pre>

will list all possible completions in a separate buffer:

<pre>Click &lt;mouse-2&gt; on a completion to select it.  In this
buffer, type RET to select the completion near point.

Possible completions are:
solve				   solve,CHMfactor,ANY
solve,CHMfactor,ANY-method	   solve,CHMfactor,ddenseMatrix
solve,CHMfactor,ddenseMatrix-method
solve,CHMfactor,dsparseMatrix	   solve,CHMfactor,dsparseMatrix-method
solve,CHMfactor,matrix		   solve,CHMfactor,matrix-method
solve,CHMfactor,numeric		   solve,CHMfactor,numeric-method
.
.
.
</pre>
Note that one possible completion is
<pre>solve,CHMfactor,matrix-method</pre>

which points to the documentation file for this method.  Generally,
all <code>\alias</code> entries in documentation files are tagged,
usually resulting in duplicate entries for most function definitions.
In such cases, <code>M-.</code> will bring up the first match, and
subsequent matches can be visited by the shortcut <code>C-u M-.</code>
(this is a standard Emacs feature).

<h2>Tips</h2>

<p>You can have Emacs read your TAGS table (stored in, say,
<code>~/rtags/TAGS</code>) during startup by putting the following in
your <code>.emacs</code> file:

<pre>(visit-tags-table "~/rtags/TAGS")</pre>

If you find yourself using <code>C-u M-.</code> frequently to visit
multiple locations of a tag, you might also find it useful to define a
simpler shortcut; e.g.,

<pre>(defun find-next-tag ()
  (interactive)
  (find-tag "" t))

(global-set-key (kbd "C-&gt;") 'find-next-tag)</pre>

</p>


<hr>
<address>deepayan.sarkar@r-project.org</address>
<!-- hhmts start -->Last modified: Tue Jun  1 11:41:48 IST 2010 <!-- hhmts end -->
</body> </html>
